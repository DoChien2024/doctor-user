<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gửi kết quả khám</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .pill { border-radius: 999px; padding: .35rem .8rem; font-weight: 600; }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div class="container py-4">
    <h3 class="mb-3">Gửi kết quả khám</h3>

    <div class="card mb-3">
        <div class="card-body">
            <div class="mb-2"><strong>Mã lịch hẹn:</strong> <span th:text="${b.id}">1001</span></div>
            <div class="mb-2"><strong>Bệnh nhân:</strong> <span th:text="${b.customerName}">Nguyễn Văn A</span></div>
            <div class="mb-2"><strong>Dịch vụ:</strong> <span th:text="${b.service != null ? b.service.name : 'Dịch vụ'}">Khám tổng quát</span></div>
            <div class="mb-2"><strong>Thời gian:</strong> <span th:text="${#temporals.format(b.appointmentTime, 'dd/MM/yyyy - HH:mm')}">2025-08-25 08:30</span></div>
            <div class="mb-2">
                <strong>Trạng thái:</strong>
                <span class="pill text-white"
                      th:classappend="${b.status.name() == 'PENDING'} ? ' bg-secondary' :
                              (${b.status.name() == 'CONFIRMED'} ? ' bg-primary' :
                              (${b.status.name() == 'DONE'} ? ' bg-success' : ' bg-danger'))"
                      th:text="${b.status}">PENDING</span>
            </div>
        </div>
    </div>

    <form th:action="@{/doctor/results/{id}/submit(id=${b.id})}" method="post" class="card">
        <input type="hidden" name="doctorId" th:if="${doctorId != null}" th:value="${doctorId}">
        <div class="card-body">
            <label class="form-label">Tóm tắt kết quả (ngắn gọn)</label>
            <textarea name="resultNote" class="form-control" rows="6"
                      placeholder="Ví dụ: Khám tổng quát bình thường; đề nghị tái khám sau 6 tháng..."
                      th:text="${b.resultNote}"></textarea>
            <div class="mt-3 d-flex gap-2">
                <button class="btn btn-success">Gửi kết quả</button>
                <a class="btn btn-outline-secondary"
                   th:href="${doctorId != null} ? @{/doctor/schedule(doctorId=${doctorId})} : @{/doctor/schedule}">
                    Hủy
                </a>
            </div>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
